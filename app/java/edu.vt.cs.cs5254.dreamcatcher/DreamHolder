package edu.vt.cs.cs5254.dreamcatcher

import android.text.format.DateFormat
import android.view.View
import android.widget.ImageView
import android.widget.TextView
import androidx.recyclerview.widget.RecyclerView
import edu.vt.cs.cs5254.dreamcatcher.database.Dream

class DreamHolder(view: View, val callbacks: DreamListFragment.Callbacks?) : RecyclerView.ViewHolder(view), View.OnClickListener {

    //model fields
    private lateinit var dream: Dream

    //view fields
    private val titleTextView: TextView = itemView.findViewById(R.id.dream_title)
    private val dateTextView: TextView = itemView.findViewById(R.id.dream_date)
    private val dreamImageView: ImageView = itemView.findViewById(R.id.dream_icon)

    // date
    private val dateFormat = DateFormat.getMediumDateFormat(this@DreamHolder.itemView.context)

    init {
        itemView.setOnClickListener(this)
    }

    fun bind(dream: Dream) {
        this.dream = dream
        titleTextView.text = this.dream.description
        dateTextView.text = dateFormat.format(this.dream.dateRevealed)
        when {
            dream.isDeferred -> {
                dreamImageView.setImageResource(R.drawable.dream_deferred_icon)
                dreamImageView.tag = R.drawable.dream_deferred_icon
            }
            dream.isRealized -> {
                dreamImageView.setImageResource(R.drawable.dream_realized_icon)
                dreamImageView.tag = R.drawable.dream_realized_icon
            }
            else -> {
                dreamImageView.setImageResource(0)
                dreamImageView.tag = 0
            }
        }
    }

    override fun onClick(v: View?) {
        callbacks?.onDreamSelected(dream.id)
    }
}
